---
- name: Elasticsearch | Check dir exists
  stat: path="{{ es_dest_install_path }}/{{ es_version }}" 
  register: es_dir_result
  tags: install

- name: Elasticsearch | Download and Install Package
  unarchive:
    src: "{{ es_src_pkg }}"
    dest: "{{ es_dest_install_path }}"
    remote_src: "{{ es_remote_src }}"
    keep_newer: yes
  when: not es_dir_result.stat.exists
  tags: install

- name: Elasticsearch | Ensure Link elasticsearch
  file: src="{{ es_dest_install_path }}/{{ es_version }}" dest="{{ es_dest_install_path }}/{{ es_name }}" state=link
  tags: install

- name: Elasticsearch | ADD bin directory in PATH
  lineinfile:
    dest: /etc/profile
    state: present
    regexp: 'export PATH=$PATH:*"{{ es_name }}"/bin'
    line: 'export PATH=$PATH:{{ es_dest_install_path }}/{{ es_name }}/bin'
    backrefs: yes
  tags: line

- name: Elasticsearch | Ajust Permission
  file: name="{{ item }}" owner={{ es_name }} group={{ es_name }} recurse=yes
  with_items:
    - "{{ es_dest_install_path }}/{{ es_version }}"
  tags: install
